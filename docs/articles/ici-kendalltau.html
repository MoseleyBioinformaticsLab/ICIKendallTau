<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ICIKendallTau">
<title>Information-Content-Informed Kendall Tau Correlation • ICIKendallTau</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Information-Content-Informed Kendall Tau Correlation">
<meta property="og:description" content="ICIKendallTau">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ICIKendallTau</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/ici-kendalltau.html">Information-Content-Informed Kendall Tau Correlation</a>
    <a class="dropdown-item" href="../articles/testing-for-left-censorship.html">Testing for Left Censorship</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/moseleybioinformaticslab/ICIKendallTau/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Information-Content-Informed Kendall Tau Correlation</h1>
                        <h4 data-toc-skip class="author">Robert M Flight
&amp; Hunter NB Moseley</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/moseleybioinformaticslab/ICIKendallTau/blob/HEAD/vignettes/ici-kendalltau.Rmd" class="external-link"><code>vignettes/ici-kendalltau.Rmd</code></a></small>
      <div class="d-none name"><code>ici-kendalltau.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://moseleybioinformaticslab.github.io/ICIKendallTau/" class="external-link">ICIKendallTau</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="problem">Problem<a class="anchor" aria-label="anchor" href="#problem"></a>
</h2>
<ul>
<li>How to handle missing data (i.e. <code>NA</code>’s) in calculating a
correlation between two variables.</li>
<li>Current calculations of correlation are based on having all pairs of
observations for two variables.
<ul>
<li>However, whether an observation is made is semi-quantitative
information for many analytical measurements with sensitivity
limits.</li>
<li>i.e. in many cases, missing observations are not
“missing-at-random”, but “missing-not-at-random” due to falling below
the detection limit.</li>
<li>In these cases, the <code>NA</code> is informative.</li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="approach">Approach<a class="anchor" aria-label="anchor" href="#approach"></a>
</h2>
<p>A <a href="https://en.wikipedia.org/wiki/Kendall_rank_correlation_coefficient" class="external-link">Kendall
Tau Correlation coefficient</a> calculates correlation based on the
number of concordant and discordant pairs:</p>
<ul>
<li><span class="math inline">\(\tau = \frac{ | pairs_{concordant}  | -
| pairs_{discordant}  |}{\binom{n}{2}}\)</span></li>
<li>A pair are two x-y data points.</li>
<li>A concordant pair has the following classical definition:
<ul>
<li>
<span class="math inline">\(x_i &gt; x_j\)</span> and <span class="math inline">\(y_i &gt; y_j\)</span>
</li>
<li>
<span class="math inline">\(x_i &lt; x_j\)</span> and <span class="math inline">\(y_i &lt; y_j\)</span>
</li>
</ul>
</li>
<li>A discordant pair has the following classical definition:
<ul>
<li>
<span class="math inline">\(x_i &gt; x_j\)</span> and <span class="math inline">\(y_i &lt; y_j\)</span>
</li>
<li>
<span class="math inline">\(x_i &lt; x_j\)</span> and <span class="math inline">\(y_i &gt; y_j\)</span>
</li>
</ul>
</li>
</ul>
<p><em>But these definitions can be expanded to handle missing
observations:</em></p>
<ul>
<li>Information content informed concordant pairs:
<ul>
<li>
<span class="math inline">\(x_i &gt; x_j\)</span> and <span class="math inline">\(y_i &gt; y_j\)</span>
</li>
<li>
<span class="math inline">\(x_i &lt; x_j\)</span> and <span class="math inline">\(y_i &lt; y_j\)</span>
</li>
<li>
<span class="math inline">\(x_i &gt; x_j\)</span> and <span class="math inline">\(y_i \&amp; !y_j\)</span>
</li>
<li>
<span class="math inline">\(x_i &lt; x_j\)</span> and <span class="math inline">\(!y_i \&amp; y_j\)</span>
</li>
<li>
<span class="math inline">\(x_i \&amp; !x_j\)</span> and <span class="math inline">\(y_i &gt; y_j\)</span>
</li>
<li>
<span class="math inline">\(!x_i \&amp; x_j\)</span> and <span class="math inline">\(y_i &lt; y_j\)</span>
</li>
<li>
<span class="math inline">\(x_i \&amp; !x_j\)</span> and <span class="math inline">\(y_i \&amp; !y_j\)</span> (not used in local
perspective version)</li>
<li>
<span class="math inline">\(x_i \&amp; x_j\)</span> and <span class="math inline">\(!y_i \&amp; y_j\)</span> (not used in local
perspective version)</li>
</ul>
</li>
<li>Information content informed discordant pairs:
<ul>
<li>
<span class="math inline">\(x_i &gt; x_j\)</span> and <span class="math inline">\(y_i &lt; y_j\)</span>
</li>
<li>
<span class="math inline">\(x_i &lt; x_j\)</span> and <span class="math inline">\(y_i &gt; y_j\)</span>
</li>
<li>
<span class="math inline">\(x_i &gt; x_j\)</span> and <span class="math inline">\(!y_i \&amp; y_j\)</span>
</li>
<li>
<span class="math inline">\(x_i &lt; x_j\)</span> and <span class="math inline">\(y_i \&amp; !y_j\)</span>
</li>
<li>
<span class="math inline">\(x_i \&amp; !x_j\)</span> and <span class="math inline">\(y_i &lt; y_j\)</span>
</li>
<li>
<span class="math inline">\(!x_i \&amp; x_j\)</span> and <span class="math inline">\(y_i &gt; y_j\)</span>
</li>
<li>
<span class="math inline">\(x_i \&amp; !x_j\)</span> and <span class="math inline">\(!y_i \&amp; y_j\)</span> (not used in local
perspective version)</li>
<li>
<span class="math inline">\(!x_i \&amp; x_j\)</span> and <span class="math inline">\(y_i \&amp; !y_j\)</span> (not used in local
perspective version)</li>
</ul>
</li>
<li>Also data points with both missing x and y values will naturally
reduce the strength of the correlation value, since they can be neither
concordant nor discordant with another (NA, NA) pair, but will impact
the denominator.</li>
<li>Alternatively, (NA,NA) points can be removed to calculate a
correlation that is specific to the two variables and does not consider
missing data from a global dataset perspective that spans a set of
variables.
<ul>
<li>If this local perspective is used, then two data points that are
both missing data, should not be compared.
<ul>
<li>This is equivalent to removing the last two concordant and
discordant pair tests.</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="handling-tied-values">Handling Tied Values<a class="anchor" aria-label="anchor" href="#handling-tied-values"></a>
</h2>
<p>The base Kendall tau correlation must be adjusted to handle tied
values, ie. the <a href="https://en.wikipedia.org/wiki/Kendall_rank_correlation_coefficient#Accounting_for_ties" class="external-link">tau-b</a>
version of the equation.</p>
<p><span class="math display">\[\tau = \frac{ | pairs_{concordant}  |
-  | pairs_{discordant}  |}{\sqrt{ ( n_0 - n_{xtie}  )  ( n_0 -
n_{ytie}  )}} \]</span> where:</p>
<ul>
<li><span class="math inline">\(n_0 = \frac{n \left ( n - 1 \right
)}{2}\)</span></li>
<li><span class="math inline">\(n_{xtie} = \sum_{i}^{} \frac{t_{xi}
\left ( t_{xi} - 1 \right )}{2}\)</span></li>
<li><span class="math inline">\(n_{ytie} = \sum_{i}^{} \frac{t_{yi}
\left ( t_{yi} - 1 \right )}{2}\)</span></li>
<li>
<span class="math inline">\(t_{xi}\)</span> - the size of the ith
group of tied x values.</li>
<li>
<span class="math inline">\(t_{yi}\)</span> - the size of the ith
group of tied y values.</li>
<li>From the local perspective, the number of NAs in x and y can be
treated as a group of tied values in calculation of <span class="math inline">\(n_{xtie}\)</span> and <span class="math inline">\(n_{ytie}\)</span>, respectively.</li>
</ul>
</div>
<div class="section level2">
<h2 id="scaling-by-the-correlation-with-the-highest-information-content">Scaling by the correlation with the highest information content<a class="anchor" aria-label="anchor" href="#scaling-by-the-correlation-with-the-highest-information-content"></a>
</h2>
<p>When generating a correlation matrix (heatmap) for large analytical
datasets, the number of observations in common can become quite low
between any two variables. It becomes advantageous to scale by the pair
of variables with the highest information content. One objective scaling
factor is the highest possible absolute correlation at the maximum
information content observed across a dataset, and dividing by this
maximum possible absolute correlation would scale the whole dataset
appropriately.</p>
<p><span class="math display">\[maxcorr = \frac{\binom{n-m}{2} + n *
m}{\binom{n-m}{2} + n * m + \binom{m}{2}}\]</span> Where:</p>
<ul>
<li>Choose the two variables with <em>the least number</em> of missing
values across the dataset.</li>
<li>n is the length of the variables.</li>
<li>m is the count of missing values across the two variables divided by
two rounded down.
<ul>
<li>This formula is based on perfect correlation with a given number of
(NA,NA) pairs added.</li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="functions">Functions<a class="anchor" aria-label="anchor" href="#functions"></a>
</h2>
<p>The functions that implement this include:</p>
<ul>
<li>
<code>ici_kt</code>: the workhorse, actually calculating a
correlation between X and Y vectors.
<ul>
<li>The option <code>perspective</code> will control how the
<code>NA</code> values influence ties.</li>
<li>When comparing multiple samples, you likely want to use
<code>perspective = "global"</code>.</li>
</ul>
</li>
<li>
<code>ici_kendallt</code>: Handles comparisons for a matrix.
<ul>
<li>Rows are features, columns are samples.</li>
<li>Implicitly parallel, but have to call:
<ul>
<li><code><a href="https://github.com/DavisVaughan/furrr" class="external-link">library(furrr)</a></code></li>
<li><code>plan(multiprocess)</code></li>
</ul>
</li>
<li>Otherwise will only use a single core.</li>
</ul>
</li>
</ul>
<p>We’ve also included a function for testing if the missingness in your
data comes from left-censorship, <code>test_left_censorship</code>. We
walk through creating example data and testing it in the vignette <a href="vignette(%22Testing%20for%20Left%20Censorship%22,%20package%20=%20%22ICIKendallTau%22)">Testing
for Left Censorship</a>.</p>
</div>
<div class="section level2">
<h2 id="implementation">Implementation<a class="anchor" aria-label="anchor" href="#implementation"></a>
</h2>
<p>It turns out, if we think about it really hard, all that is truly
necessary is to replace missing values in each vector with a value
smaller than the minimum value in each one. For the
<strong>local</strong> version, we first remove common missing values
from each vector. Our C++ implementation explicitly does this so that we
can have speed, instead of wrapping the {stats::cor} function. We also
use the double merge-sort algorithm, translating {scipy::
::stats::kendalltau} function into C++ using {Rcpp}.</p>
</div>
<div class="section level2">
<h2 id="speed">Speed<a class="anchor" aria-label="anchor" href="#speed"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/joshuaulrich/microbenchmark/" class="external-link">microbenchmark</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, method <span class="op">=</span> <span class="st">"kendall"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/ici_kt.html">ici_kt</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="st">"global"</span><span class="op">)</span>,</span>
<span>  times <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Unit: microseconds</span></span>
<span><span class="co">#&gt;                           expr       min        lq       mean    median</span></span>
<span><span class="co">#&gt;  cor(x, y, method = "kendall") 14160.951 15092.146 16718.1198 15776.550</span></span>
<span><span class="co">#&gt;         ici_kt(x, y, "global")   347.058   351.564   468.7134   354.905</span></span>
<span><span class="co">#&gt;         uq       max neval</span></span>
<span><span class="co">#&gt;  19233.783 19327.169     5</span></span>
<span><span class="co">#&gt;    556.035   734.005     5</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="../reference/ici_kt.html">ici_kt</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="st">"global"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, method <span class="op">=</span> <span class="st">"kendall"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="running-many">Running Many<a class="anchor" aria-label="anchor" href="#running-many"></a>
</h2>
<p>Just like R’s <code>cor</code> function, we can also calculate
correlations between many variables. Let’s make some fake data and try
it out.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1000</span>, mean <span class="op">=</span> <span class="fl">100</span>, sd <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">s2</span> <span class="op">=</span> <span class="va">s1</span> <span class="op">+</span> <span class="fl">10</span></span>
<span><span class="va">s2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">s1</span><span class="op">)</span>, <span class="fl">100</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="va">s1</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span></span>
<span><span class="va">s3</span> <span class="op">=</span> <span class="va">s1</span></span>
<span><span class="va">s3</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">s1</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="va">matrix_1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">s1</span>, <span class="va">s2</span>, <span class="va">s3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">r_1</span> <span class="op">=</span> <span class="fu"><a href="../reference/ici_kendalltau.html">ici_kendalltau</a></span><span class="op">(</span><span class="va">matrix_1</span><span class="op">)</span></span>
<span><span class="va">r_1</span><span class="op">$</span><span class="va">cor</span></span>
<span><span class="co">#&gt;           s1        s2        s3</span></span>
<span><span class="co">#&gt; s1 1.0000000 0.8049209 0.9907488</span></span>
<span><span class="co">#&gt; s2 0.8049209 1.0000000 0.7956652</span></span>
<span><span class="co">#&gt; s3 0.9907488 0.7956652 0.9850000</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="parallelism">Parallelism<a class="anchor" aria-label="anchor" href="#parallelism"></a>
</h2>
<p>If you have {future} and the {furrr} packages installed, then it is
also possible to split up the a set of matrix comparisons across compute
resources for any multiprocessing engine registered with {future}.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DavisVaughan/furrr" class="external-link">furrr</a></span><span class="op">)</span></span>
<span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multicore</span>, workers <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">r_2</span> <span class="op">=</span> <span class="fu"><a href="../reference/ici_kendalltau.html">ici_kendalltau</a></span><span class="op">(</span><span class="va">matrix_1</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="many-many-comparisons">Many Many Comparisons<a class="anchor" aria-label="anchor" href="#many-many-comparisons"></a>
</h2>
<p>In the case of hundreds of thousands of comparisons to be done, the
result matrices can become very, very large, and require lots of memory
for storage. They are also inefficient, as both the lower and upper
triangular components are stored. An alternative storage format is as a
<code>data.frame</code>, where there is a single row for each comparison
performed. This is actually how the results are stored internally, and
then they are converted to a matrix form if requested (the default). To
keep the <code>data.frame</code> output, add the argument
<code>return_matrix=FALSE</code> to the call of
<code>ici_kendalltau</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r_3</span> <span class="op">=</span> <span class="fu"><a href="../reference/ici_kendalltau.html">ici_kendalltau</a></span><span class="op">(</span><span class="va">matrix_1</span>, return_matrix <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">r_3</span><span class="op">$</span><span class="va">cor</span></span>
<span><span class="co">#&gt;   s1 s2 core       raw pvalue    taumax       cor</span></span>
<span><span class="co">#&gt; 1 s1 s2    1 0.8049209      0 1.0000000 0.8049209</span></span>
<span><span class="co">#&gt; 2 s1 s3    1 0.9907488      0 0.9998949 0.9907488</span></span>
<span><span class="co">#&gt; 3 s2 s3    1 0.7956652      0 0.9998949 0.7956652</span></span>
<span><span class="co">#&gt; 4 s1 s1    0 1.0000000      0 1.0000000 1.0000000</span></span>
<span><span class="co">#&gt; 5 s2 s2    0 1.0000000      0 1.0000000 1.0000000</span></span>
<span><span class="co">#&gt; 6 s3 s3    0 0.9850000      0 1.0000000 0.9850000</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="logging">Logging<a class="anchor" aria-label="anchor" href="#logging"></a>
</h2>
<p>It is possible to log the steps being done and how much memory is
being used (on Linux at least) as correlations are calculated. This can
be useful when running very large sets of correlations and making sure
too much memory isn’t being used, for example.</p>
<p>To enable logging, the {logger} package must be installed. If a
<code>log_file</code> is not supplied, one will be created with the
current date and time.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/enable_logging.html">enable_logging</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/enable_logging.html">enable_logging</a></span><span class="op">(</span><span class="st">"/tmp/my_ici_run.log"</span><span class="op">)</span></span></code></pre></div>
<p>By default, <code>ici_kendalltau</code> also shows progress messages,
if you want to turn them off, you can do:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/show_progress.html">show_progress</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Robert M Flight, Hunter NB Moseley.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
