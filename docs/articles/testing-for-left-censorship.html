<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Testing for Left Censorship • ICIKendallTau</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Testing for Left Censorship">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ICIKendallTau</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/ici-kendalltau.html">Information-Content-Informed Kendall Tau Correlation</a></li>
    <li><a class="dropdown-item" href="../articles/testing-for-left-censorship.html">Testing for Left Censorship</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/moseleybioinformaticslab/ICIKendallTau/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Testing for Left Censorship</h1>
                        <h4 data-toc-skip class="author">Robert M Flight
and Hunter NB Moseley</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/moseleybioinformaticslab/ICIKendallTau/blob/HEAD/vignettes/testing-for-left-censorship.Rmd" class="external-link"><code>vignettes/testing-for-left-censorship.Rmd</code></a></small>
      <div class="d-none name"><code>testing-for-left-censorship.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://moseleybioinformaticslab.github.io/ICIKendallTau/" class="external-link">ICIKendallTau</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="why">Why?<a class="anchor" aria-label="anchor" href="#why"></a>
</h2>
<p>{ICIKendallTau} has a very specific assumption, that the missing
values are <strong>largely</strong> due to being below the limit of
detection, or the result of left-censorship. Therefore, it should only
be used <strong>if</strong> the missing values are from left-censorship.
Ideally, it would be nice to have a way to test for it.</p>
</div>
<div class="section level2">
<h2 id="strategy">Strategy<a class="anchor" aria-label="anchor" href="#strategy"></a>
</h2>
<p>To test this, we do the following (implemented in
<code>test_left_censorship</code>). For any feature that is missing in
one or more samples in a class of samples, we check if the non-missing
entries are below their sample’s median values. We count all of the
entries below sample medians as successes, and the total number of
possible entries as the number of trials in a binomial test, aggregating
across all features that had a missing value. We can then perform a
one-tailed binomial test with the expectation that the successes are
greater than 0.5.</p>
</div>
<div class="section level2">
<h2 id="fake-data">Fake Data<a class="anchor" aria-label="anchor" href="#fake-data"></a>
</h2>
<p>To start, we need to make some fake data that we can evaluate the
test on. We will make a smallish dataset, with 1000 features across 20
samples, and we will have 80% of the missing values be due to being
left-censored.</p>
<p>We sort the initial data so we know where we can easily put
missingness due to left-censoring. We also use a log-normal distribution
initially, just because.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">n_feature</span> <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="va">n_sample</span> <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="va">n_miss</span> <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="va">n_low</span> <span class="op">=</span> <span class="fl">80</span></span>
<span><span class="va">test_dataset</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span><span class="va">n_feature</span>, <span class="fl">10</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">test_dataset</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">test_dataset</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">noisy_dataset</span> <span class="op">=</span> <span class="fu"><a href="../reference/add_uniform_noise.html">add_uniform_noise</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">test_dataset</span><span class="op">)</span>, <span class="va">n_sample</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">sample_medians</span> <span class="op">=</span> <span class="fu"><a href="../reference/calculate_matrix_medians.html">calculate_matrix_medians</a></span><span class="op">(</span><span class="va">noisy_dataset</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="add-missingness">Add Missingness<a class="anchor" aria-label="anchor" href="#add-missingness"></a>
</h2>
<p>Now we can sample some low and high indices to add our missingness,
as well as some samples to add them to.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">low_indices</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">300</span><span class="op">)</span>, <span class="va">n_low</span><span class="op">)</span></span>
<span><span class="va">hi_indices</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">800</span>, <span class="fl">1000</span><span class="op">)</span>, <span class="va">n_miss</span> <span class="op">-</span> <span class="va">n_low</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">all_indices</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">low_indices</span>, <span class="va">hi_indices</span><span class="op">)</span></span>
<span><span class="va">sample_indices</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">n_sample</span>, <span class="va">n_miss</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">missing_dataset</span> <span class="op">=</span> <span class="va">noisy_dataset</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i_loc</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">all_indices</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">missing_dataset</span><span class="op">[</span><span class="va">all_indices</span><span class="op">[</span><span class="va">i_loc</span><span class="op">]</span>, <span class="va">sample_indices</span><span class="op">[</span><span class="va">i_loc</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We can actually visualize the missingness using the
<code>visdat</code> package.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">visdat</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/visdat/reference/vis_miss.html" class="external-link">vis_miss</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">missing_dataset</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="testing-for-left-censorship_files/figure-html/examine-missingness-1.png" alt="Missing entries in the test dataset." width="700"><p class="caption">
Missing entries in the test dataset.
</p>
</div>
</div>
<div class="section level2">
<h2 id="test">Test<a class="anchor" aria-label="anchor" href="#test"></a>
</h2>
<p>Now we can actually test the missingness entries.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">missing_test</span> <span class="op">=</span> <span class="fu"><a href="../reference/test_left_censorship.html">test_left_censorship</a></span><span class="op">(</span><span class="va">missing_dataset</span><span class="op">)</span></span>
<span><span class="va">missing_test</span></span>
<span><span class="co">#&gt; $values</span></span>
<span><span class="co">#&gt;   trials success class</span></span>
<span><span class="co">#&gt; 1   1900    1520     A</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $binomial_test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Exact binomial test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  total_success and total_trials</span></span>
<span><span class="co">#&gt; number of successes = 1520, number of trials = 1900, p-value &lt; 2.2e-16</span></span>
<span><span class="co">#&gt; alternative hypothesis: true probability of success is greater than 0.5</span></span>
<span><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span><span class="co">#&gt;  0.7843033 1.0000000</span></span>
<span><span class="co">#&gt; sample estimates:</span></span>
<span><span class="co">#&gt; probability of success </span></span>
<span><span class="co">#&gt;                    0.8</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="rna-seq-example">RNA-Seq Example<a class="anchor" aria-label="anchor" href="#rna-seq-example"></a>
</h2>
<p>Gierliński et al (<a href="https://doi.org/10.1093/bioinformatics/btv425" class="external-link">link</a>) did a
really neat experiment in yeast, with a large number of replicates, 48
WT and 48 SNF2 deletion mutant. We’ve included a summarized experiment
as part of this package, and use it to demonstrate the left-censorship
in a real data context.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">yeast_missing</span><span class="op">)</span></span>
<span><span class="va">yeast_classes</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"snf2"</span>, <span class="st">"wt"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">48</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yeast_stats</span> <span class="op">=</span> <span class="fu"><a href="../reference/test_left_censorship.html">test_left_censorship</a></span><span class="op">(</span><span class="va">yeast_missing</span>, sample_classes <span class="op">=</span> <span class="va">yeast_classes</span><span class="op">)</span></span>
<span><span class="va">yeast_stats</span></span>
<span><span class="co">#&gt; $values</span></span>
<span><span class="co">#&gt;   trials success class</span></span>
<span><span class="co">#&gt; 1  18336   18336  snf2</span></span>
<span><span class="co">#&gt; 2  20424   20424    wt</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $binomial_test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Exact binomial test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  total_success and total_trials</span></span>
<span><span class="co">#&gt; number of successes = 38760, number of trials = 38760, p-value &lt;</span></span>
<span><span class="co">#&gt; 2.2e-16</span></span>
<span><span class="co">#&gt; alternative hypothesis: true probability of success is greater than 0.5</span></span>
<span><span class="co">#&gt; 95 percent confidence interval:</span></span>
<span><span class="co">#&gt;  0.9999227 1.0000000</span></span>
<span><span class="co">#&gt; sample estimates:</span></span>
<span><span class="co">#&gt; probability of success </span></span>
<span><span class="co">#&gt;                      1</span></span></code></pre></div>
<p>In addition to testing, we can re-order the features based on their
median ranking across samples.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yeast_order</span> <span class="op">=</span> <span class="fu"><a href="../reference/rank_order_data.html">rank_order_data</a></span><span class="op">(</span><span class="va">yeast_missing</span>, sample_classes <span class="op">=</span> <span class="va">yeast_classes</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">visdat</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/visdat/reference/vis_miss.html" class="external-link">vis_miss</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">yeast_order</span><span class="op">$</span><span class="va">wt</span><span class="op">$</span><span class="va">original</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="testing-for-left-censorship_files/figure-html/fig-yeast-original-1.png" alt="Missingness in yeast data set, no ordering." width="700"><p class="caption">
Missingness in yeast data set, no ordering.
</p>
</div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">visdat</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/visdat/reference/vis_miss.html" class="external-link">vis_miss</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">yeast_order</span><span class="op">$</span><span class="va">wt</span><span class="op">$</span><span class="va">ordered</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="testing-for-left-censorship_files/figure-html/fig-yeast-reordered-1.png" alt="Missingness in yeast data set, after ordering features by rank." width="700"><p class="caption">
Missingness in yeast data set, after ordering features by rank.
</p>
</div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yeast_n_na</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">yeast_order</span><span class="op">$</span><span class="va">wt</span><span class="op">$</span><span class="va">n_na_rank</span>,</span>
<span>                              <span class="va">yeast_order</span><span class="op">$</span><span class="va">snf2</span><span class="op">$</span><span class="va">n_na_rank</span><span class="op">)</span></span>
<span><span class="va">yeast_n_na</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">n_na</span>, y <span class="op">=</span> <span class="va">median_rank</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.1</span>, position <span class="op">=</span> <span class="st">"jitter"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">split</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="testing-for-left-censorship_files/figure-html/fig-yeast-nna-1.png" alt="Feature rank as a function of the number of missing values." width="700"><p class="caption">
Feature rank as a function of the number of missing values.
</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robert M Flight, Hunter NB Moseley.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
